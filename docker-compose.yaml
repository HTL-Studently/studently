version: '3.3'
services:

  # https://doc.traefik.io/traefik/user-guides/docker-compose/basic-example/
    
  traefik:
    image: "traefik:v2.10"
    container_name: "traefik"
    command:
      - "--api.insecure=true"
      - "--providers.docker=true"
      - "--providers.docker.exposedbydefault=false"

      - "--entrypoints.api.address=:8081"
      - "--entrypoints.mdb.address=:8082"
    ports:
      - "8080:8080"   # Traefik Dashboard
      - "80:80"
      - "8081:8081"
      - "8082:8082"
    volumes:
      - "./letsencrypt:/letsencrypt"
      - "/var/run/docker.sock:/var/run/docker.sock"
      - "./traefik-config.yml:/etc/traefik/traefik-config.yml"


  fastapi:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: "fastapi"
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.fastapi.rule=Host(`10.1.1.134`)"
      - "traefik.http.routers.fastapi.entrypoints=api"
    ports:
      - 8085:8085



  mongodb:
    image: mongo:latest
    container_name: "mongodb"
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.mongodb.rule=Host(`10.1.1.134`)"
      - "traefik.http.routers.mongodb.entrypoints=mdb"
      # - "traefik.http.routers.mongodb.tls.certresolver=myresolver"
    ports:
      - '27017:27017'
    environment:
      MONGO_INITDB_ROOT_USERNAME: studently
      MONGO_INITDB_ROOT_PASSWORD: studently
    depends_on:
      - traefik
    volumes:
      - mongodb_data:/data/db

   


volumes:
  mongodb_data:

